<h2>Invoice</h2>

<p><strong>Bill No:</strong> <%= @bill.id %></p>
<p><strong>Date:</strong> <%= @bill.created_at.strftime("%d %b %Y") %></p>

<hr>

<h3>Purchased Items</h3>

<table width="100%" border="1" cellspacing="0" cellpadding="6">
  <thead>
    <tr>
      <th>Product</th>
      <th>Unit Price</th>
      <th>Qty</th>
      <th>Purchase Price</th>
      <th>Tax %</th>
      <th>Tax</th>
      <th>Total</th>
    </tr>
  </thead>
  <tbody>
    <% @bill.bill_items.each do |item| %>
      <tr>
        <td><%= item.product.name %></td>
        <td>₹ <%= item.unit_price %></td>
        <td><%= item.quantity %></td>
        <td>₹ <%= item.unit_price * item.quantity %></td>
        <td><%= item.tax_percentage %>%</td>
        <td>₹ <%= item.tax_amount %></td>
        <td>₹ <%= item.total_price %></td>
      </tr>
    <% end %>
  </tbody>
</table>

<hr>

<h3>Summary</h3>

<p>Total (without tax): ₹ <%= @bill.total_without_tax %></p>
<p>Total tax: ₹ <%= @bill.total_tax %></p>
<p><strong>Net amount:</strong> ₹ <%= @bill.net_amount %></p>
<p>Paid: ₹ <%= @bill.paid_amount %></p>
<p>Balance to return: ₹ <%= @bill.balance_amount %></p>

<hr>

<h3>Change Given</h3>

<% total_returned = 0 %>

<ul>
  <% @bill.bill_denominations.each do |bd| %>
    <% amount = bd.denomination.value * bd.count %>
    <% total_returned += amount %>
    <li>₹ <%= bd.denomination.value %> × <%= bd.count %> = ₹ <%= amount %></li>
  <% end %>
</ul>

<% remaining = @bill.balance_amount - total_returned %>

<% if remaining > 0 %>
  <p style="color:red;">
    ⚠ ₹ <%= remaining %> could not be returned due to unavailable denominations.
  </p>
<% end %>
